<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rust WebAssembly Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #005a8b;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #output {
            background: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            min-height: 100px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>🦀 Rust WebAssembly Demo</h1>
    
    <div class="container">
        <h2>问候功能</h2>
        <input type="text" id="name-input" placeholder="输入您的名字" value="WebAssembly">
        <button onclick="greetPerson()">打招呼</button>
    </div>

    <div class="container">
        <h2>数学计算</h2>
        <input type="number" id="num1" placeholder="数字1" value="5">
        <span>+</span>
        <input type="number" id="num2" placeholder="数字2" value="3">
        <button onclick="calculateSum()">计算和</button>
    </div>

    <div class="container">
        <h2>斐波那契数列</h2>
        <input type="number" id="fib-input" placeholder="输入数字" value="10" min="0" max="40">
        <button onclick="calculateFibonacci()">计算斐波那契</button>
    </div>

    <div class="container">
        <h2>输出</h2>
        <div id="output">请点击上面的按钮来测试 WebAssembly 功能...</div>
    </div>

    <script type="module">
        import init, { greet, add, fibonacci } from './pkg/world_wasm.js';
        
        async function run() {
            // 初始化 wasm 模块
            await init();
            
            // 使函数在全局范围内可用
            window.wasm = { greet, add, fibonacci };
            
            appendOutput("✅ WebAssembly 模块加载成功!");
        }
        
        function appendOutput(message) {
            const output = document.getElementById('output');
            output.innerHTML += message + '<br>';
            output.scrollTop = output.scrollHeight;
        }
        
        window.greetPerson = function() {
            const name = document.getElementById('name-input').value;
            window.wasm.greet(name);
            appendOutput(`👋 向 "${name}" 打招呼! (查看控制台)`);
        }
        
        window.calculateSum = function() {
            const num1 = parseInt(document.getElementById('num1').value) || 0;
            const num2 = parseInt(document.getElementById('num2').value) || 0;
            const result = window.wasm.add(num1, num2);
            appendOutput(`🧮 ${num1} + ${num2} = ${result}`);
        }
        
        window.calculateFibonacci = function() {
            const n = parseInt(document.getElementById('fib-input').value) || 0;
            if (n > 40) {
                appendOutput('⚠️  为了性能考虑，请输入小于40的数字');
                return;
            }
            const start = performance.now();
            const result = window.wasm.fibonacci(n);
            const end = performance.now();
            appendOutput(`🔢 第${n}个斐波那契数: ${result} (耗时: ${(end-start).toFixed(2)}ms)`);
        }
        
        // 初始化模块
        run().catch(console.error);
    </script>
</body>
</html>